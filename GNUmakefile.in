#
#   GNUmakefile.in
#
#   Main GNUmakefile for the GNUstep GNUmakefile Package.
#
#   Copyright (C) 1997 Free Software Foundation, Inc.
#
#   Author:  Scott Christley <scottc@net-community.com>
#
#   This file is part of the GNUstep Makefile Package.
#
#   This library is free software; you can redistribute it and/or
#   modify it under the terms of the GNU General Public License
#   as published by the Free Software Foundation; either version 2
#   of the License, or (at your option) any later version.
#   
#   You should have received a copy of the GNU General Public
#   License along with this library; see the file COPYING.LIB.
#   If not, write to the Free Software Foundation,
#   59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.

#
# I've thought about using the Makefile package files
# to install the GNUmakefile package, a cool little recursion,
# but there is nothing to made, and the files get installed
# in a special directory, so it was simpler this way.
#

include config.make

GNUSTEP_INSTALLATION_DIR = @prefix@
srcdir = @srcdir@
prefix = $(GNUSTEP_INSTALLATION_DIR)
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@
datadir = @datadir@

GNUSTEP_TARGET_CPU := @target_cpu@
GNUSTEP_TARGET_OS := @target_os@

GNUSTEP_TARGET_CPU := $(shell ./clean_cpu.sh $(GNUSTEP_TARGET_CPU))
GNUSTEP_TARGET_VENDOR := $(shell ./clean_vendor.sh $(GNUSTEP_TARGET_VENDOR))
GNUSTEP_TARGET_OS := $(shell ./clean_os.sh $(GNUSTEP_TARGET_OS))

makedir = $(prefix)/Makefiles
tooldir = $(prefix)/Tools
GNUSTEP_TARGET_DIR = $(GNUSTEP_TARGET_CPU)/$(GNUSTEP_TARGET_OS)

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@

all: generated-files which_lib

which_lib: which_lib.c
	$(CC) -O2 -Wall -o $@ $^

install: all
	$(srcdir)/mkinstalldirs $(prefix) $(makedir) \
		$(makedir)/$(GNUSTEP_TARGET_CPU) \
		$(makedir)/$(GNUSTEP_TARGET_DIR) \
		$(tooldir) \
		$(prefix)/share \
		$(prefix)/Apps \
		$(prefix)/Libraries/$(GNUSTEP_TARGET_DIR) \
		$(prefix)/Headers/$(GNUSTEP_TARGET_DIR) \
		$(prefix)/Tools/$(GNUSTEP_TARGET_DIR) \
		$(prefix)/Library \
		$(prefix)/Library/info \
		$(prefix)/Library/PostScript \
		$(prefix)/Library/man
	$(INSTALL_PROGRAM) -m 755 which_lib $(makedir)/$(GNUSTEP_TARGET_DIR)
	for f in config.guess config.sub install-sh mkinstalldirs \
		GNUstep.sh MediaBook.sh clean_cpu.sh clean_os.sh \
		clean_vendor.sh cpu.sh ld_lib_path.sh os.sh \
		transform_paths.sh vendor.sh \
		GNUstep.csh ld_lib_path.csh ; do \
	  $(INSTALL_PROGRAM) -m 755 $$f $(makedir); \
	done
	$(INSTALL_PROGRAM) -m 755 openapp $(tooldir); \
	$(INSTALL_PROGRAM) -m 755 debugapp $(tooldir); \
	for f in aggregate.make application.make bundle.make \
		common.make brain.make library.make rules.make target.make \
		tool.make test-library.make names.make objc.make \
		test-application.make test-tool.make \
		documentation.make MediaBook.func; do \
	  $(INSTALL_DATA) $$f $(makedir); \
	done
	$(INSTALL_DATA) config.site $(prefix)/share
	$(INSTALL_DATA) config.make $(makedir)/$(GNUSTEP_TARGET_DIR)

uninstall:
	rm -f $(makedir)/$(GNUSTEP_TARGET_DIR)/which_lib
	for f in config.guess config.sub install-sh mkinstalldirs \
		GNUstep.sh MediaBook.sh clean_cpu.sh clean_os.sh \
		clean_vendor.sh cpu.sh ld_lib_path.sh os.sh \
		transform_paths.sh vendor.sh \
		GNUstep.csh ld_lib_path.csh ; do \
	  rm -f $(makedir)/$$f; \
	done
	rm -f $(tooldir)/openapp; \
	rm -f $(tooldir)/debugapp; \
	for f in aggregate.make application.make bundle.make \
		common.make brain.make library.make rules.make target.make \
		tool.make test-library.make names.make objc.make \
		test-application.make test-tool.make \
		documentation.make MediaBook.func; do \
	  rm -f $(makedir)/$$f; \
	done
	rm -f $(prefix)/share/config.site
	rm -f $(makedir)/$(GNUSTEP_TARGET_DIR)/config.make

clean:
	rm -f *~ which_lib

distclean: clean
	rm -f GNUmakefile config.make
	rm -f config.cache config.log config.status

generated-files: GNUmakefile GNUstep.sh GNUstep.csh config.h config.make debugapp openapp

GNUmakefile: GNUmakefile.in config.status
	$(SHELL) config.status

GNUstep.sh: GNUstep.sh.in
	$(SHELL) config.status

GNUstep.csh: GNUstep.csh.in
	$(SHELL) config.status

config.h: config.h.in
	$(SHELL) config.status

config.make: config.make.in
	$(SHELL) config.status

debugapp: debugapp.in
	$(SHELL) config.status

openapp: openapp.in
	$(SHELL) config.status
